<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgroFusion ‚Äî Smart Farming Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #2d6a4f;
    --green-light: #52b788;
    --green-bright: #74c69d;
    --yellow: #f4a261;
    --yellow-bright: #ffd166;
    --brown: #6b4226;
    --soil: #a0522d;
    --cream: #fefae0;
    --white: #ffffff;
    --dark: #1a2e1a;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Nunito', sans-serif;
    background: var(--dark);
    min-height: 100vh;
    overflow-x: hidden;
  }
  /* VIDEO BACKGROUND */
  .video-bg {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    overflow: hidden;
  }
  .video-bg video {
    width: 100%; height: 100%;
    object-fit: cover;
    opacity: 0.45;
  }
  .video-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(135deg, rgba(26,46,26,0.85) 0%, rgba(45,106,79,0.6) 50%, rgba(26,46,26,0.9) 100%);
    z-index: 1;
  }
  /* CANVAS FALLBACK for video bg */
  canvas#bgCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
  }
  /* PAGES */
  .page { position: relative; z-index: 2; min-height: 100vh; display: none; }
  .page.active { display: flex; }
  /* ===== NAVBAR ===== */
  nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 40px;
    background: rgba(26,46,26,0.7);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(116,198,157,0.2);
  }
  .nav-logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .nav-logo .logo-icon {
    width: 42px; height: 42px;
    background: linear-gradient(135deg, var(--green-bright), var(--yellow));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
  }
  .nav-logo span {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    font-weight: 900;
    color: var(--cream);
    letter-spacing: -0.5px;
  }
  .nav-logo span b { color: var(--green-bright); }
  .nav-tagline {
    font-size: 0.78rem;
    color: rgba(254,250,224,0.6);
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
  }
  /* ===== LOGIN PAGE ===== */
  #loginPage {
    align-items: center;
    justify-content: center;
    padding-top: 80px;
  }
  .login-card {
    background: rgba(26,46,26,0.75);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(116,198,157,0.25);
    border-radius: 28px;
    padding: 52px 48px;
    width: 440px;
    max-width: 95vw;
    box-shadow: 0 40px 80px rgba(0,0,0,0.5), 0 0 0 1px rgba(116,198,157,0.1);
    animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(40px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .login-header {
    text-align: center;
    margin-bottom: 36px;
  }
  .login-header .wheat-icon {
    font-size: 3.5rem;
    display: block;
    margin-bottom: 12px;
    animation: sway 3s ease-in-out infinite;
  }
  @keyframes sway {
    0%, 100% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
  }
  .login-header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    font-weight: 900;
    color: var(--cream);
    margin-bottom: 6px;
  }
  .login-header p {
    color: var(--green-bright);
    font-size: 0.9rem;
    font-weight: 600;
  }
  .form-group {
    margin-bottom: 20px;
    position: relative;
  }
  .form-group label {
    display: block;
    color: rgba(254,250,224,0.8);
    font-size: 0.82rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .form-group .input-wrap {
    position: relative;
  }
  .form-group .input-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.1rem;
    z-index: 1;
  }
  .form-group input {
    width: 100%;
    background: rgba(255,255,255,0.07);
    border: 1.5px solid rgba(116,198,157,0.2);
    border-radius: 14px;
    padding: 14px 16px 14px 46px;
    color: var(--cream);
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    transition: all 0.3s;
    outline: none;
  }
  .form-group input::placeholder { color: rgba(254,250,224,0.35); }
  .form-group input:focus {
    border-color: var(--green-bright);
    background: rgba(116,198,157,0.1);
    box-shadow: 0 0 0 4px rgba(116,198,157,0.15);
  }
  .btn-primary {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--green-light), var(--green-bright));
    border: none;
    border-radius: 14px;
    color: var(--dark);
    font-family: 'Nunito', sans-serif;
    font-size: 1rem;
    font-weight: 800;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    margin-top: 8px;
  }
  .btn-primary::after {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    width: 0; height: 0;
    background: rgba(255,255,255,0.3);
    border-radius: 50%;
    transform: translate(-50%,-50%);
    transition: width 0.5s, height 0.5s;
  }
  .btn-primary:hover::after { width: 300px; height: 300px; }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(82,183,136,0.4); }
  .btn-primary:active { transform: translateY(0); }
  .login-footer {
    text-align: center;
    margin-top: 24px;
    color: rgba(254,250,224,0.4);
    font-size: 0.82rem;
  }
  .login-footer span { color: var(--green-bright); cursor: pointer; font-weight: 700; }
  .error-msg {
    background: rgba(231,76,60,0.15);
    border: 1px solid rgba(231,76,60,0.4);
    border-radius: 10px;
    color: #ff8c7a;
    font-size: 0.85rem;
    padding: 10px 14px;
    margin-bottom: 16px;
    display: none;
    font-weight: 600;
  }
  /* ===== DASHBOARD PAGE ===== */
  #dashPage {
    flex-direction: column;
    padding-top: 80px;
  }
  .dash-content {
    flex: 1;
    padding: 40px;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
  }
  .dash-welcome {
    margin-bottom: 36px;
    animation: slideUp 0.6s ease;
  }
  .dash-welcome h2 {
    font-family: 'Playfair Display', serif;
    font-size: 2.4rem;
    color: var(--cream);
    font-weight: 900;
    line-height: 1.2;
  }
  .dash-welcome h2 span { color: var(--yellow-bright); }
  .dash-welcome p { color: rgba(254,250,224,0.6); font-size: 1rem; margin-top: 8px; font-weight: 600; }
  .input-section {
    background: rgba(26,46,26,0.7);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(116,198,157,0.2);
    border-radius: 24px;
    padding: 40px;
    margin-bottom: 32px;
    animation: slideUp 0.7s ease;
  }
  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem;
    color: var(--green-bright);
    font-weight: 700;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, rgba(116,198,157,0.4), transparent);
  }
  .inputs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 20px;
  }
  .field-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .field-group label {
    color: rgba(254,250,224,0.7);
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .field-group label .lbl-icon { font-size: 1rem; }
  .field-group input, .field-group select {
    background: rgba(255,255,255,0.06);
    border: 1.5px solid rgba(116,198,157,0.18);
    border-radius: 12px;
    padding: 13px 16px;
    color: var(--cream);
    font-family: 'Nunito', sans-serif;
    font-size: 0.93rem;
    font-weight: 600;
    transition: all 0.3s;
    outline: none;
    -webkit-appearance: none;
  }
  .field-group select option { background: #1a2e1a; color: var(--cream); }
  .field-group input::placeholder { color: rgba(254,250,224,0.3); }
  .field-group input:focus, .field-group select:focus {
    border-color: var(--green-bright);
    background: rgba(116,198,157,0.08);
    box-shadow: 0 0 0 3px rgba(116,198,157,0.12);
  }
  .analyze-btn {
    display: block;
    width: 100%;
    max-width: 360px;
    margin: 32px auto 0;
    padding: 18px 40px;
    background: linear-gradient(135deg, var(--yellow), var(--yellow-bright));
    border: none;
    border-radius: 16px;
    color: var(--dark);
    font-family: 'Nunito', sans-serif;
    font-size: 1.1rem;
    font-weight: 800;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 1.5px;
  }
  .analyze-btn:hover { transform: translateY(-3px); box-shadow: 0 16px 40px rgba(244,162,97,0.4); }
  .analyze-btn:active { transform: translateY(0); }
  /* LOADING */
  .loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 999;
    background: rgba(26,46,26,0.9);
    backdrop-filter: blur(6px);
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 20px;
  }
  .loading-overlay.show { display: flex; }
  .loading-spinner {
    width: 70px; height: 70px;
    border: 4px solid rgba(116,198,157,0.2);
    border-top-color: var(--green-bright);
    border-radius: 50%;
    animation: spin 0.9s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-overlay p {
    color: var(--cream);
    font-size: 1.1rem;
    font-weight: 700;
  }
  .loading-overlay .loading-sub {
    color: var(--green-bright);
    font-size: 0.85rem;
    font-weight: 600;
    animation: pulse 1.5s ease infinite;
  }
  @keyframes pulse { 0%,100%{opacity:0.5} 50%{opacity:1} }
  /* ===== RESULT PAGE ===== */
  #resultPage {
    flex-direction: column;
    padding-top: 80px;
  }
  .result-content {
    flex: 1;
    padding: 40px;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
  }
  .result-hero {
    background: linear-gradient(135deg, rgba(45,106,79,0.8), rgba(82,183,136,0.5));
    border: 1px solid rgba(116,198,157,0.3);
    border-radius: 24px;
    padding: 40px;
    margin-bottom: 28px;
    text-align: center;
    position: relative;
    overflow: hidden;
    animation: slideUp 0.5s ease;
  }
  .result-hero::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: radial-gradient(circle at 50% 50%, rgba(116,198,157,0.15) 0%, transparent 60%);
    pointer-events: none;
  }
  .result-crop-icon { font-size: 5rem; margin-bottom: 12px; display: block; }
  .result-hero h2 {
    font-family: 'Playfair Display', serif;
    font-size: 2.5rem;
    color: var(--cream);
    font-weight: 900;
  }
  .result-hero h2 span { color: var(--yellow-bright); }
  .result-hero .confidence {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,209,102,0.15);
    border: 1px solid rgba(255,209,102,0.3);
    border-radius: 30px;
    padding: 6px 18px;
    color: var(--yellow-bright);
    font-weight: 700;
    font-size: 0.9rem;
    margin-top: 12px;
  }
  .result-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
    animation: slideUp 0.6s ease;
  }
  .result-card {
    background: rgba(26,46,26,0.75);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(116,198,157,0.2);
    border-radius: 20px;
    padding: 28px;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .result-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  }
  .card-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
  .card-label { font-size: 0.78rem; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: rgba(254,250,224,0.5); margin-bottom: 6px; }
  .card-value { font-size: 1.6rem; font-weight: 800; color: var(--cream); }
  .card-value.green { color: var(--green-bright); }
  .card-value.yellow { color: var(--yellow-bright); }
  .card-value.orange { color: var(--yellow); }
  .card-sub { font-size: 0.85rem; color: rgba(254,250,224,0.5); margin-top: 4px; font-weight: 600; }
  .market-card {
    background: linear-gradient(135deg, rgba(244,162,97,0.2), rgba(255,209,102,0.1));
    border-color: rgba(244,162,97,0.3);
    grid-column: span 2;
  }
  @media(max-width:640px) { .market-card { grid-column: span 1; } }
  .market-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid rgba(244,162,97,0.2);
  }
  .market-price {
    text-align: center;
  }
  .market-price .mp-label { font-size: 0.75rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: rgba(254,250,224,0.5); }
  .market-price .mp-val { font-size: 1.4rem; font-weight: 800; color: var(--yellow-bright); }
  .trend-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.9rem;
  }
  .trend-badge.rising { background: rgba(82,183,136,0.2); color: var(--green-bright); border: 1px solid rgba(82,183,136,0.3); }
  .trend-badge.falling { background: rgba(231,76,60,0.2); color: #ff8c7a; border: 1px solid rgba(231,76,60,0.3); }
  .advice-box {
    background: rgba(26,46,26,0.75);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(116,198,157,0.25);
    border-left: 4px solid var(--green-bright);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 24px;
    animation: slideUp 0.7s ease;
  }
  .advice-box h3 {
    font-family: 'Playfair Display', serif;
    color: var(--green-bright);
    font-size: 1.1rem;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .advice-box p { color: rgba(254,250,224,0.85); line-height: 1.7; font-size: 0.95rem; font-weight: 600; }
  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: rgba(116,198,157,0.15);
    border: 1.5px solid rgba(116,198,157,0.3);
    border-radius: 12px;
    color: var(--green-bright);
    font-family: 'Nunito', sans-serif;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 32px;
    text-decoration: none;
  }
  .back-btn:hover { background: rgba(116,198,157,0.25); transform: translateX(-4px); }
  /* PROGRESS BAR for confidence */
  .confidence-bar {
    height: 8px;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
    margin-top: 10px;
    overflow: hidden;
  }
  .confidence-fill {
    height: 100%;
    border-radius: 4px;
    background: linear-gradient(90deg, var(--green-bright), var(--yellow-bright));
    transition: width 1.5s cubic-bezier(0.16, 1, 0.3, 1);
    width: 0;
  }
  /* Weather card */
  .weather-row {
    display: flex;
    gap: 20px;
    margin-top: 12px;
  }
  .weather-item { flex: 1; text-align: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 10px; }
  .weather-item .wi-val { font-size: 1.3rem; font-weight: 800; color: var(--cream); }
  .weather-item .wi-label { font-size: 0.72rem; color: rgba(254,250,224,0.5); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
  /* Floating particles */
  .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
  .particle {
    position: absolute;
    width: 4px; height: 4px;
    background: rgba(116,198,157,0.4);
    border-radius: 50%;
    animation: float linear infinite;
  }
  @keyframes float {
    0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { transform: translateY(-20px) rotate(720deg); opacity: 0; }
  }
  /* BACKEND TEST BUTTON */
  .backend-test-bar {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 28px;
    flex-wrap: wrap;
    animation: slideUp 0.5s ease;
  }
  .btn-backend {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 22px;
    background: rgba(255,255,255,0.07);
    border: 1.5px solid rgba(116,198,157,0.3);
    border-radius: 12px;
    color: var(--green-bright);
    font-family: 'Nunito', sans-serif;
    font-size: 0.88rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
  }
  .btn-backend:hover:not(:disabled) {
    background: rgba(116,198,157,0.15);
    border-color: var(--green-bright);
    transform: translateY(-2px);
  }
  .btn-backend:disabled { opacity: 0.7; cursor: not-allowed; }
  .backend-status {
    display: none;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    padding: 9px 16px;
    border-radius: 10px;
    flex: 1;
    min-width: 0;
  }
  .backend-status code {
    font-family: monospace;
    font-size: 0.8rem;
    background: rgba(0,0,0,0.2);
    padding: 2px 6px;
    border-radius: 4px;
  }
  .backend-status.pending { background: rgba(255,209,102,0.1); border: 1px solid rgba(255,209,102,0.25); color: var(--yellow-bright); }
  .backend-status.success { background: rgba(82,183,136,0.12); border: 1px solid rgba(82,183,136,0.3); color: var(--green-bright); }
  .backend-status.error   { background: rgba(231,76,60,0.1); border: 1px solid rgba(231,76,60,0.3); color: #ff8c7a; }
  /* Responsive */
  @media(max-width:768px) {
    nav { padding: 14px 20px; }
    .dash-content, .result-content { padding: 20px; }
    .input-section { padding: 24px 20px; }
    .dash-welcome h2 { font-size: 1.7rem; }
    .result-hero { padding: 28px 20px; }
    .result-hero h2 { font-size: 1.8rem; }
    .login-card { padding: 36px 28px; }
  }
</style>
</head>
<body>
<!-- BACKGROUND -->
<canvas id="bgCanvas"></canvas>
<div class="video-overlay"></div>
<!-- PARTICLES -->
<div class="particles" id="particles"></div>
<!-- NAVBAR -->
<nav>
  <div class="nav-logo">
    <div class="logo-icon">üåø</div>
    <div>
      <span>Agro<b>Fusion</b></span>
      <div class="nav-tagline">Smart Farming Intelligence</div>
    </div>
  </div>
  <div id="navUser" style="color:rgba(254,250,224,0.6); font-weight:700; font-size:0.9rem; display:none;">
    üë®‚Äçüåæ <span id="navUserName"></span>
  </div>
</nav>
<body>

  <h2>Crop Recommendation</h2>

  <label>Soil Type:</label>
  <select id="soil_type">
    <option value="clay">Clay</option>
    <option value="red">Red</option>
  </select>

  <label>Season:</label>
  <select id="season">
    <option value="Kharif">Kharif</option>
    <option value="Rabi">Rabi</option>
  </select>

  <!-- ‚úÖ BUTTON GOES HERE -->
  <button class="analyze-btn" onclick="analyzeData()">
    Get Recommendation
  </button>

  <h3 id="resCropName"></h3>

  <!-- ‚úÖ SCRIPT ALWAYS AT BOTTOM -->
  <script>
    async function analyzeData() {
      try {
        const soil = document.getElementById("soil_type").value;
        const season = document.getElementById("season").value;

        const response = await fetch("http://127.0.0.1:8000/predict", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            soil_type: soil,
            season: season
          })
        });

        const data = await response.json();
        document.getElementById("resCropName").innerText =
          data.recommended_crop;

      } catch (error) {
        console.error(error);
      }
    }
  </script>

</body>
<!-- LOADING -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <p>üî¨ Analyzing Your Farm Data</p>
  <div class="loading-sub">Running AI crop intelligence...</div>
</div>
<!-- ===== LOGIN PAGE ===== -->
<div id="loginPage" class="page active">
  <div class="login-card">
    <div class="login-header">
      <span class="wheat-icon">üåæ</span>
      <h1>Welcome, Farmer!</h1>
      <p>Sign in to your AgroFusion dashboard</p>
    </div>
    <div class="error-msg" id="loginError">‚ö†Ô∏è Please enter a valid 10-digit mobile number</div>
    <div class="form-group">
      <label>Mobile Number</label>
      <div class="input-wrap">
        <span class="input-icon">üì±</span>
        <input type="tel" id="loginPhone" placeholder="Enter your 10-digit mobile number" maxlength="10" pattern="[0-9]{10}" inputmode="numeric" />
      </div>
    </div>
    <button class="btn-primary" onclick="doLogin()">üöú Enter Dashboard</button>
    <div class="login-footer">
      Enter your registered mobile number to continue<br>
      New farmer? <span>Register here</span>
    </div>
  </div>
</div>
<!-- ===== DASHBOARD PAGE ===== -->
<div id="dashPage" class="page">
  <div class="dash-content">
    <div class="backend-test-bar">
      <button class="btn-backend" id="testBackendBtn" onclick="testBackend()">üîå Test Backend</button>
      <div class="backend-status" id="backendStatus"></div>
    </div>
    <div class="dash-welcome">
      <h2>Hello, <span id="farmerName">Farmer</span>! üëã<br>Let's analyze your farm üå±</h2>
      <p>Fill in your farm details below and let our AI recommend the best crop for you.</p>
    </div>
    <div class="input-section">
      <div class="section-title">üó∫Ô∏è Farm Location & Land</div>
      <div class="inputs-grid">
        <div class="field-group">
          <label><span class="lbl-icon">üìç</span> Location</label>
          <input type="text" id="location" placeholder="e.g., Andhra Pradesh, India" />
        </div>
        <div class="field-group">
          <label><span class="lbl-icon">üìè</span> Land Size (acres)</label>
          <input type="number" id="land_size" placeholder="e.g., 5" min="0" />
        </div>
        <div class="field-group">
          <label><span class="lbl-icon">ü™®</span> Soil Type</label>
          <select id="soil_type">
            <option value="" disabled selected>Select soil type</option>
            <option>Sandy</option>
            <option>Loamy</option>
            <option>Clay</option>
            <option>Silty</option>
            <option>Red Soil</option>
            <option>Black Cotton Soil</option>
            <option>Alluvial</option>
          </select>
        </div>
        <div class="field-group">
          <label><span class="lbl-icon">üíß</span> Water Availability</label>
          <select id="water_availability">
            <option value="" disabled selected>Select availability</option>
            <option>High</option>
            <option>Medium</option>
            <option>Low</option>
            <option>Rainfed</option>
          </select>
        </div>
      </div>
    </div>
    <div class="input-section">
      <div class="section-title">üåæ Crop & Season Details</div>
      <div class="inputs-grid">
        <div class="field-group">
          <label><span class="lbl-icon">üîÑ</span> Previous Crop</label>
          <input type="text" id="previous_crop" placeholder="e.g., Rice, Wheat, Cotton" />
        </div>
        <div class="field-group">
          <label><span class="lbl-icon">üí∞</span> Budget</label>
          <select id="budget">
            <option value="" disabled selected>Select budget range</option>
            <option>Low (< ‚Çπ10,000)</option>
            <option>Medium (‚Çπ10,000 ‚Äì ‚Çπ50,000)</option>
            <option>High (> ‚Çπ50,000)</option>
          </select>
        </div>
        <div class="field-group">
          <label><span class="lbl-icon">üóìÔ∏è</span> Season</label>
          <select id="season">
            <option value="" disabled selected>Select season</option>
            <option>Kharif (Monsoon)</option>
            <option>Rabi (Winter)</option>
            <option>Zaid (Summer)</option>
            <option>Year-round</option>
          </select>
        </div>
      </div>
    </div>
    <div class="input-section">
      <div class="section-title">üå§Ô∏è Weather Conditions</div>
      <div class="inputs-grid">
        <div class="field-group">
          <label><span class="lbl-icon">üå°Ô∏è</span> Temperature (¬∞C)</label>
          <input type="number" id="temperature" placeholder="e.g., 28" min="-20" max="60" />
        </div>
        <div class="field-group">
          <label><span class="lbl-icon">üåßÔ∏è</span> Rainfall (mm)</label>
          <input type="number" id="rainfall" placeholder="e.g., 400" min="0" />
        </div>
        <div class="field-group">
          <label><span class="lbl-icon">üí¶</span> Humidity (%)</label>
          <input type="number" id="humidity" placeholder="e.g., 65" min="0" max="100" />
        </div>
      </div>
    </div>
    <button class="analyze-btn" onclick="analyzeData()">üî¨ Analyze & Get Recommendation</button>
  </div>
</div>
<!-- ===== RESULT PAGE ===== -->
<div id="resultPage" class="page">
  <div class="result-content">
    <button class="back-btn" onclick="goBack()">‚Üê Back to Farm Input</button>
    <div class="result-hero">
      <span class="result-crop-icon" id="resCropIcon">ü•ú</span>
      <h2>Recommended Crop: <span id="resCropName">Groundnut</span></h2>
      <div class="confidence">
        ‚úÖ Confidence: <strong id="resConfidence">70%</strong>
      </div>
      <div class="confidence-bar" style="max-width:400px; margin:16px auto 0;">
        <div class="confidence-fill" id="confFill"></div>
      </div>
    </div>
    <div class="result-cards">
      <div class="result-card">
        <span class="card-icon">üì¶</span>
        <div class="card-label">Expected Yield</div>
        <div class="card-value green" id="resYield">79.2 quintal</div>
        <div class="card-sub">Estimated production</div>
      </div>
      <div class="result-card">
        <span class="card-icon">üí∞</span>
        <div class="card-label">Price per Quintal</div>
        <div class="card-value yellow" id="resPrice">‚Çπ2000</div>
        <div class="card-sub">Estimated market rate</div>
      </div>
      <div class="result-card">
        <span class="card-icon">‚ö†Ô∏è</span>
        <div class="card-label">Weather Risk</div>
        <div class="card-value" id="resRisk" style="color:var(--green-bright)">Low Risk</div>
        <div class="card-sub">Based on your climate data</div>
      </div>
      <div class="result-card market-card">
        <span class="card-icon">üìà</span>
        <div class="card-label">Market Intelligence</div>
        <div class="market-row">
          <div class="market-price">
            <div class="mp-label">Today's Price</div>
            <div class="mp-val" id="mktToday">‚Çπ26.67</div>
          </div>
          <div class="market-price">
            <div class="mp-label">Future Price</div>
            <div class="mp-val" id="mktFuture">‚Çπ26.90</div>
          </div>
          <div>
            <div class="trend-badge rising" id="mktTrend">üìà Rising</div>
            <div style="margin-top:8px; font-size:0.82rem; color:rgba(254,250,224,0.6); font-weight:700;" id="mktRec">Hold for better price</div>
          </div>
        </div>
      </div>
      <div class="result-card">
        <span class="card-icon">üå°Ô∏è</span>
        <div class="card-label">Weather Summary</div>
        <div class="weather-row">
          <div class="weather-item">
            <div class="wi-val" id="wsTemp">25¬∞C</div>
            <div class="wi-label">Avg Temp</div>
          </div>
          <div class="weather-item">
            <div class="wi-val" id="wsRain">400mm</div>
            <div class="wi-label">Total Rain</div>
          </div>
        </div>
      </div>
    </div>
    <div class="advice-box">
      <h3>üå± Expert Advice</h3>
      <p id="resAdvice">Based on your soil and water conditions, Groundnut is recommended for your farm.</p>
    </div>
  </div>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ========== CANVAS BACKGROUND ==========
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
function drawFarmBg() {
  const w = canvas.width, h = canvas.height;
  ctx.clearRect(0, 0, w, h);
  // Sky gradient
  const sky = ctx.createLinearGradient(0, 0, 0, h * 0.6);
  sky.addColorStop(0, '#0d1f0d');
  sky.addColorStop(1, '#1a3a1a');
  ctx.fillStyle = sky;
  ctx.fillRect(0, 0, w, h * 0.6);
  // Ground
  const ground = ctx.createLinearGradient(0, h * 0.6, 0, h);
  ground.addColorStop(0, '#2d5a1e');
  ground.addColorStop(1, '#1a3a0a');
  ctx.fillStyle = ground;
  ctx.fillRect(0, h * 0.6, w, h * 0.4);
  // Draw crop rows (animated)
  const t = Date.now() / 1000;
  for (let row = 0; row < 8; row++) {
    const y = h * 0.62 + row * (h * 0.05);
    const rowColor = `rgba(${40 + row * 6}, ${120 + row * 8}, ${40 + row * 3}, ${0.3 - row * 0.02})`;
    ctx.fillStyle = rowColor;
    ctx.fillRect(0, y, w, 8);
    // Plant stems
    for (let x = 0; x < w; x += 40) {
      const sway = Math.sin(t + x * 0.05 + row) * 3;
      const cropH = 20 + row * 5;
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(x + sway, y - cropH);
      ctx.strokeStyle = `rgba(82,183,136,${0.4 - row * 0.04})`;
      ctx.lineWidth = 1.5;
      ctx.stroke();
      // leaf
      ctx.beginPath();
      ctx.ellipse(x + sway + 5, y - cropH + 4, 5, 3, 0.5, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(116,198,157,${0.25 - row * 0.02})`;
      ctx.fill();
    }
  }
  // Sun glow
  const sunGrad = ctx.createRadialGradient(w * 0.8, h * 0.1, 0, w * 0.8, h * 0.1, 120);
  sunGrad.addColorStop(0, 'rgba(255,209,102,0.25)');
  sunGrad.addColorStop(1, 'rgba(255,209,102,0)');
  ctx.fillStyle = sunGrad;
  ctx.fillRect(0, 0, w, h);
  requestAnimationFrame(drawFarmBg);
}
drawFarmBg();
window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
// ========== PARTICLES ==========
function createParticles() {
  const container = document.getElementById('particles');
  const emojis = ['üåø', 'üçÄ', 'üå±', 'üçÉ', 'üåæ'];
  for (let i = 0; i < 20; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    if (Math.random() > 0.7) {
      p.style.fontSize = '14px';
      p.style.background = 'none';
      p.style.width = 'auto';
      p.style.height = 'auto';
      p.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    }
    p.style.left = Math.random() * 100 + 'vw';
    p.style.animationDuration = (8 + Math.random() * 15) + 's';
    p.style.animationDelay = (Math.random() * 15) + 's';
    p.style.opacity = 0;
    container.appendChild(p);
  }
}
createParticles();
// ========== PAGES ==========
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
// ========== LOGIN ==========
function doLogin() {
  const phone = document.getElementById('loginPhone').value.trim();
  const err = document.getElementById('loginError');
  err.style.display = 'none';
  if (/^[0-9]{10}$/.test(phone)) {
    const displayName = 'Farmer ' + phone.slice(-4); // show last 4 digits as identifier
    document.getElementById('farmerName').textContent = displayName;
    document.getElementById('navUserName').textContent = '+91 ' + phone;
    document.getElementById('navUser').style.display = 'flex';
    showPage('dashPage');
  } else {
    err.style.display = 'block';
  }
}
document.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    if (document.getElementById('loginPage').classList.contains('active')) doLogin();
  }
});
// Allow only digits in phone field
document.addEventListener('DOMContentLoaded', () => {
  const ph = document.getElementById('loginPhone');
  if (ph) {
    ph.addEventListener('input', () => {
      ph.value = ph.value.replace(/\D/g, '').slice(0, 10);
    });
  }
});
// ========== ANALYZE ‚Äî calls real backend via script.js ==========
const cropIcons = {
  groundnut: 'ü•ú', rice: 'üåæ', wheat: 'üåæ', cotton: 'üåø',
  maize: 'üåΩ', sugarcane: 'üéã', soybean: 'ü´ò', tomato: 'üçÖ',
  default: 'üå±'
};
function analyzeData() {
  const loading = document.getElementById('loadingOverlay');
  loading.classList.add('show');
  const payload = {
    location:           document.getElementById('location').value.trim(),
    land_size:          parseFloat(document.getElementById('land_size').value) || 0,
    soil_type:          document.getElementById('soil_type').value,
    water_availability: document.getElementById('water_availability').value,
    previous_crop:      document.getElementById('previous_crop').value.trim(),
    budget:             document.getElementById('budget').value,
    season:             document.getElementById('season').value,
    temperature:        parseFloat(document.getElementById('temperature').value) || 0,
    rainfall:           parseFloat(document.getElementById('rainfall').value) || 0,
    humidity:           parseFloat(document.getElementById('humidity').value) || 0
  };
  // Fetch result entirely from backend ‚Äî no mock fallback
  callPredictAPI(payload)
    .then(result => {
      loading.classList.remove('show');
      populateResults(result);
      showPage('resultPage');
      setTimeout(() => {
        document.getElementById('confFill').style.width = (result.confidence_score * 100) + '%';
      }, 300);
    })
    .catch(err => {
      loading.classList.remove('show');
      console.error("Backend error:", err);
      showApiError(err.message);
    });
}
function showApiError(msg) {
  // Remove any existing error toast
  const old = document.getElementById('apiErrorToast');
  if (old) old.remove();
  const toast = document.createElement('div');
  toast.id = 'apiErrorToast';
  toast.style.cssText = `
    position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%);
    background: rgba(30,10,10,0.95); border: 1.5px solid rgba(231,76,60,0.5);
    border-radius: 14px; padding: 18px 28px; z-index: 9999;
    display: flex; align-items: center; gap: 14px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    backdrop-filter: blur(12px); max-width: 90vw;
    animation: slideUp 0.4s cubic-bezier(0.16,1,0.3,1);
  `;
  toast.innerHTML = `
    <span style="font-size:1.6rem;">‚ö†Ô∏è</span>
    <div>
      <div style="color:#ff8c7a; font-weight:800; font-size:0.95rem; font-family:'Nunito',sans-serif;">Backend Error</div>
      <div style="color:rgba(255,200,180,0.75); font-size:0.82rem; margin-top:3px; font-family:'Nunito',sans-serif;">${msg || 'Could not reach the server at ' + BACKEND_URL}</div>
    </div>
    <button onclick="this.parentElement.remove()" style="background:none;border:none;color:rgba(255,150,130,0.6);font-size:1.2rem;cursor:pointer;margin-left:8px;">‚úï</button>
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast && toast.remove(), 6000);
}
function populateResults(r) {
  const cropKey = r.recommended_crop.toLowerCase();
  document.getElementById('resCropIcon').textContent = cropIcons[cropKey] || cropIcons.default;
  document.getElementById('resCropName').textContent = r.recommended_crop;
  document.getElementById('resConfidence').textContent = (r.confidence_score * 100).toFixed(0) + '%';
  document.getElementById('resYield').textContent = r.expected_yield;
  document.getElementById('resPrice').textContent = r.estimated_price_per_quintal;
  const riskEl = document.getElementById('resRisk');
  riskEl.textContent = r.weather_risk;
  riskEl.style.color = r.weather_risk.toLowerCase().includes('low') ? 'var(--green-bright)'
    : r.weather_risk.toLowerCase().includes('medium') ? 'var(--yellow-bright)' : '#ff8c7a';
  document.getElementById('wsTemp').textContent = r.weather_summary.avg_temp + '¬∞C';
  document.getElementById('wsRain').textContent = r.weather_summary.total_rain + 'mm';
  document.getElementById('mktToday').textContent = '‚Çπ' + r.market_advice.today_price.toFixed(2);
  document.getElementById('mktFuture').textContent = '‚Çπ' + r.market_advice.future_price.toFixed(2);
  const trendEl = document.getElementById('mktTrend');
  if (r.market_advice.trend === 'rising') {
    trendEl.textContent = 'üìà Rising';
    trendEl.className = 'trend-badge rising';
  } else {
    trendEl.textContent = 'üìâ Falling';
    trendEl.className = 'trend-badge falling';
  }
  document.getElementById('mktRec').textContent = r.market_advice.recommendation;
  document.getElementById('resAdvice').textContent = r.advice;
}
function goBack() {
  showPage('dashPage');
}
</script>
<script src="script.js"></script>
</body>
</html>